---
title: "6. Neurale netvÃ¦rker"
author: "Anders Thor Kellmer"
date: "2023-06-12"
output: html_document
---

```{r setup, include=FALSE, warning = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Setting up dependencies.

```{r dependencies, warning = FALSE, message = FALSE}
library(magrittr)
library(neuralnet)
library(caret)
set.seed(123)
```
Load data.

```{r}
data("iris")
str(iris)
indexes = sample(1:nrow(iris), round(nrow(iris) * 0.85)) %>% sort()
train = iris[indexes,]
test = iris[-indexes,]
xtest = test[,-5]
ytest = test[, 5]
```

Fit neural network.

```{r}
nnet = neuralnet(
  Species ~ .,
  train,
  hidden = c(4, 3),
  linear.output = FALSE
)
plot(nnet)
```

Get predictions.

```{r}
ypred = neuralnet::compute(nnet, xtest)
yhat = ypred$net.result
print(yhat)

yhat = data.frame(
  "yhat" = ifelse(max.col(yhat[, 1:3]) == 1, "setosa",
  ifelse(max.col(yhat[, 1:3]) == 2, "versicolor", 
         "virginica"))
)
```

Make confusion matrix.

```{r}
cm = confusionMatrix(as.factor(ytest), as.factor(yhat$yhat))
cm$table
```


